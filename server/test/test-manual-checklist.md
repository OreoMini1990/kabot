# 채팅 로그 DB 및 통계 기능 수동 테스트 체크리스트

## 사전 준비

- [ ] Supabase SQL 스키마 실행 완료
- [ ] 서버 `.env` 파일에 Supabase 설정 완료
- [ ] 서버 재시작 완료
- [ ] Bridge APK 설치 및 접근성 서비스 활성화 완료

---

## 테스트 시나리오

### 1. 기본 메시지 저장 테스트

**목적**: 채팅 메시지가 DB에 정상적으로 저장되는지 확인

**절차**:
1. 카카오톡에서 일반 메시지 전송
   ```
   안녕하세요 테스트입니다
   ```

2. 서버 로그 확인
   ```bash
   # PM2 사용 시
   pm2 logs kakkaobot-server --lines 20
   
   # 확인할 로그:
   [채팅 로그] 메시지 저장 성공
   ```

3. Supabase에서 확인
   - Supabase 대시보드 > Table Editor > `chat_messages`
   - 방금 전송한 메시지가 저장되었는지 확인
   - `room_name`, `sender_name`, `message_text` 필드 확인

**예상 결과**: ✅ 메시지가 DB에 저장됨

---

### 2. 통계 명령어 테스트

**목적**: 통계 조회 명령어가 정상 작동하는지 확인

**절차**:
1. 카카오톡에서 여러 메시지 전송 (최소 5개 이상)

2. 통계 명령어 테스트
   ```
   /오늘 채팅
   /이번주 채팅
   /통계
   ```

3. 응답 확인
   - 각 명령어에 대해 통계 정보가 표시되는지 확인
   - 이모지와 함께 포맷팅된 메시지가 나오는지 확인

**예상 결과**: ✅ 통계 정보가 정상적으로 표시됨

---

### 3. 신고 기능 테스트

**목적**: 신고 기능이 정상 작동하는지 확인

**절차**:
1. 타 유저의 메시지에 답장 버튼 클릭

2. 신고 명령어 입력
   ```
   @랩봇 !신고 부적절한 내용입니다
   ```

3. 응답 확인
   - "✅ 신고 접수 완료!" 메시지 확인
   - 세련된 안내 메시지 확인

4. Supabase에서 확인
   - `reports` 테이블에서 신고 내역 확인
   - `reported_message_id`, `reporter_name`, `original_message_text` 확인

**예상 결과**: ✅ 신고가 정상적으로 저장됨

**추가 테스트**:
- 멘션 없이 "신고"만 입력 → 안내 메시지 표시 확인
- 형식이 맞지 않을 때 → 안내 메시지 표시 확인

---

### 4. 닉네임 변경 감지 테스트

**목적**: 닉네임 변경이 정상적으로 감지되는지 확인

**절차**:
1. 사용자가 닉네임 변경 (카카오톡 설정에서)

2. 메시지 전송
   ```
   닉네임 변경 테스트
   ```

3. 응답 확인
   - "🚨 닉네임 변경 감지!" 메시지 확인
   - 변경 이력이 표시되는지 확인

4. Supabase에서 확인
   - `user_name_history` 테이블에서 변경 이력 확인
   - `users` 테이블에서 `display_name` 업데이트 확인

**예상 결과**: ✅ 닉네임 변경이 감지되고 이력이 저장됨

---

### 5. !질문 기능 개선 테스트

**목적**: !질문 기능의 개선사항이 정상 작동하는지 확인

#### 5.1 이미지 없을 때 안내 메시지
**절차**:
1. 이미지 없이 질문 작성
   ```
   !질문 테스트 제목,테스트 내용
   ```

2. 응답 확인
   - "💡 참고: 사진이 첨부되어 있지 않다면 이미지 첨부도 가능합니다." 메시지 확인

**예상 결과**: ✅ 안내 메시지가 표시됨

#### 5.2 연속 등록 제한
**절차**:
1. 질문 작성
   ```
   !질문 테스트 제목,테스트 내용
   ```

2. 1시간 이내에 같은 질문 다시 작성
   ```
   !질문 테스트 제목,테스트 내용
   ```

3. 응답 확인
   - "⏸️ 연속 등록 제한" 메시지 확인
   - 카페 링크 안내 확인

**예상 결과**: ✅ 연속 등록이 제한되고 카페 링크가 안내됨

#### 5.3 직전 메시지 이미지 감지
**절차**:
1. 이미지 전송 (사진 첨부)

2. 바로 다음에 질문 작성
   ```
   !질문 테스트 제목,테스트 내용
   ```

3. 응답 확인
   - "📷 (이미지 첨부)" 메시지 확인

**예상 결과**: ✅ 이미지가 감지되고 표시됨 (실제 첨부는 미구현)

---

### 6. 통합 시나리오 테스트

**목적**: 여러 기능이 함께 작동하는지 확인

**절차**:
1. 일반 메시지 여러 개 전송
2. 통계 명령어로 확인
3. 닉네임 변경 후 메시지 전송
4. 신고 기능 테스트
5. !질문 기능 테스트

**예상 결과**: ✅ 모든 기능이 정상 작동

---

## 문제 해결

### 문제 1: 메시지가 저장되지 않음
**확인 사항**:
- Supabase 연결 확인
- `.env` 파일의 Supabase 설정 확인
- 서버 로그에서 오류 메시지 확인

### 문제 2: 통계 명령어가 작동하지 않음
**확인 사항**:
- 관리자 권한 확인 (`ADMIN_USERS` 설정)
- 명령어 형식 확인 (`/오늘 채팅` 등)
- 서버 로그 확인

### 문제 3: 신고 기능이 작동하지 않음
**확인 사항**:
- 답장 버튼을 눌렀는지 확인
- 멘션 형식 확인 (`@랩봇 !신고`)
- `reports` 테이블이 생성되었는지 확인

---

## 테스트 완료 체크리스트

- [ ] 기본 메시지 저장 테스트 완료
- [ ] 통계 명령어 테스트 완료
- [ ] 신고 기능 테스트 완료
- [ ] 닉네임 변경 감지 테스트 완료
- [ ] !질문 기능 개선 테스트 완료
- [ ] 통합 시나리오 테스트 완료

---

## 테스트 결과 기록

**테스트 일시**: _______________

**테스트자**: _______________

**결과 요약**:
- 성공: ___ 개
- 실패: ___ 개
- 비고: _______________















