# 네이버 카페 이미지 첨부 기능 기술적 제약사항

## 현재 구현 상태

### ✅ 구현 완료
1. **직전 메시지 이미지 감지**: 질문 직전 메시지에 이미지가 있는지 DB에서 확인
2. **이미지 첨부 안내 메시지**: 이미지가 없을 때 안내 메시지 표시
3. **연속 등록 제한**: 1시간 이내 같은 질문 등록 방지

### ⚠️ 기술적 제약사항

#### 1. 네이버 카페 API 이미지 첨부

**현재 상태**: ❌ **미구현**

**이유**:
- 네이버 카페 API는 이미지 첨부를 지원하지만, `multipart/form-data` 형식이 필요합니다.
- 현재 구현은 `application/x-www-form-urlencoded` 형식으로 텍스트만 전송합니다.

**구현 필요 사항**:
1. `cafeWrite.js`의 `writeCafeArticle` 함수를 `multipart/form-data` 형식으로 변경
2. 이미지 파일을 다운로드하여 FormData에 첨부
3. 네이버 카페 API의 이미지 업로드 엔드포인트 확인 및 구현

**참고 문서**:
- [네이버 카페 API 문서](https://developers.naver.com/docs/login/cafe-api/cafe-api.md)
- 네이버 카페 API는 이미지 업로드를 별도 엔드포인트로 처리할 수 있습니다.

**예상 작업 시간**: 2-4시간

#### 2. 직전 메시지 이미지 자동 첨부

**현재 상태**: ✅ **감지 가능**, ❌ **자동 첨부 미구현**

**구현 내용**:
- 질문 직전 5분 이내 메시지에서 이미지 감지
- `message_attachments` 테이블에서 이미지 URL 조회
- 이미지 URL을 변수에 저장 (`previousMessageImage`)

**미구현 사항**:
- 이미지 URL을 네이버 카페 API에 전송하는 로직
- 이미지 다운로드 및 FormData 변환

**구현 필요 사항**:
1. `previousMessageImage` URL에서 이미지 다운로드
2. 다운로드한 이미지를 `multipart/form-data` 형식으로 변환
3. 네이버 카페 API에 이미지와 함께 글 작성

**예상 작업 시간**: 1-2시간 (이미지 첨부 API 구현 후)

---

## 현재 동작 방식

### 이미지 없을 때
```
✅ 질문 작성 완료!

Q. 제목
내용

💡 참고: 사진이 첨부되어 있지 않다면 이미지 첨부도 가능합니다.
질문 직전에 이미지를 보내시면 함께 첨부됩니다.

답변하러가기: [URL]
```

### 이미지 있을 때 (감지만, 실제 첨부는 미구현)
```
✅ 질문 작성 완료!

Q. 제목
내용

📷 (이미지 첨부)

답변하러가기: [URL]
```

**참고**: 현재는 이미지를 감지하고 표시만 하며, 실제로 네이버 카페에 이미지를 첨부하지는 않습니다.

---

## 향후 구현 계획

### 단계 1: 네이버 카페 API 이미지 첨부 구현
1. `cafeWrite.js`에 이미지 파라미터 추가
2. `multipart/form-data` 형식으로 변경
3. 이미지 파일 다운로드 및 변환 로직 추가

### 단계 2: 직전 메시지 이미지 자동 첨부
1. `previousMessageImage` URL에서 이미지 다운로드
2. 다운로드한 이미지를 API에 전달
3. 네이버 카페에 이미지와 함께 글 작성

---

## 대안 방법

현재로서는:
1. 사용자가 이미지를 직접 카페에 업로드하도록 안내
2. 또는 관리자가 수동으로 이미지를 첨부

이는 기술적 제약사항이 아니라, API 구현 우선순위 문제입니다.

