# 채팅 로그 DB 및 통계 기능 테스트 가이드

## 테스트 구조

### 1. 자동 테스트 (Automated Tests)
- **파일**: `server/test/test-chat-logging.js`
- **목적**: DB 연결, 메시지 저장, 통계 조회 등 기본 기능 자동 검증
- **실행 방법**: `node test/test-chat-logging.js`

### 2. 수동 테스트 (Manual Tests)
- **파일**: `server/test/test-manual-checklist.md`
- **목적**: 실제 카카오톡 환경에서의 기능 검증
- **실행 방법**: 체크리스트에 따라 수동으로 테스트

---

## 자동 테스트 실행

### Windows (PowerShell)
```powershell
cd server
.\test\run-tests.ps1
```

### Linux/Mac (Bash)
```bash
cd server
chmod +x test/run-tests.sh
./test/run-tests.sh
```

### 직접 실행
```bash
cd server
node test/test-chat-logging.js
```

---

## 테스트 항목

### 자동 테스트 항목
1. ✅ DB 연결 테스트
2. ✅ 메시지 저장 테스트
3. ✅ 통계 조회 테스트
4. ✅ 신고 기능 테스트
5. ✅ 닉네임 변경 감지 테스트

### 수동 테스트 항목
1. ✅ 기본 메시지 저장 테스트
2. ✅ 통계 명령어 테스트 (`/오늘 채팅`, `/이번주 채팅`, `/통계`)
3. ✅ 신고 기능 테스트 (`@랩봇 !신고`)
4. ✅ 닉네임 변경 감지 테스트
5. ✅ !질문 기능 개선 테스트
   - 이미지 없을 때 안내 메시지
   - 연속 등록 제한
   - 직전 메시지 이미지 감지

---

## 테스트 시나리오

### 시나리오 1: 기본 기능 테스트
1. 카카오톡에서 일반 메시지 전송
2. 자동 테스트 실행
3. Supabase에서 데이터 확인

**예상 결과**: 모든 테스트 통과

---

### 시나리오 2: 통계 기능 테스트
1. 여러 메시지 전송 (최소 10개 이상)
2. `/오늘 채팅` 명령어 입력
3. `/이번주 채팅` 명령어 입력
4. `/통계` 명령어 입력

**예상 결과**: 통계 정보가 정상적으로 표시됨

---

### 시나리오 3: 신고 기능 테스트
1. 타 유저 메시지에 답장 버튼 클릭
2. `@랩봇 !신고 부적절한 내용` 입력
3. 신고 접수 확인 메시지 확인
4. Supabase에서 `reports` 테이블 확인

**예상 결과**: 신고가 정상적으로 저장됨

---

### 시나리오 4: 닉네임 변경 감지 테스트
1. 사용자가 닉네임 변경
2. 메시지 전송
3. 닉네임 변경 알림 확인
4. Supabase에서 `user_name_history` 확인

**예상 결과**: 닉네임 변경이 감지되고 이력이 저장됨

---

### 시나리오 5: !질문 기능 개선 테스트
1. 이미지 없이 질문 작성 → 안내 메시지 확인
2. 같은 질문 1시간 이내 재작성 → 연속 등록 제한 확인
3. 이미지 전송 후 질문 작성 → 이미지 감지 확인

**예상 결과**: 모든 개선사항이 정상 작동

---

## 문제 해결

### 테스트 실패 시 확인 사항

1. **DB 연결 실패**
   - `.env` 파일의 Supabase 설정 확인
   - Supabase 프로젝트가 활성화되어 있는지 확인
   - 네트워크 연결 확인

2. **테이블이 없다는 오류**
   - Supabase SQL 스키마 실행 확인
   - 테이블 목록에서 생성 확인

3. **권한 오류**
   - Supabase RLS 정책 확인
   - 서비스 키 사용 확인

---

## 테스트 결과 기록

테스트 완료 후 다음 정보를 기록하세요:

- **테스트 일시**: _______________
- **테스트자**: _______________
- **자동 테스트 결과**: 성공 / 실패
- **수동 테스트 결과**: 성공 / 실패
- **발견된 문제**: _______________
- **해결 방법**: _______________















