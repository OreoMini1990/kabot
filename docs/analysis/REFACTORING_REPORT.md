# λ¦¬ν©ν† λ§ μ™„λ£ λ³΄κ³ μ„

## π“‹ κ°μ”
μ„λ²„ λ° ν΄λΌμ΄μ–ΈνΈ μ½”λ“ λ¦¬ν©ν† λ§μ„ μ™„λ£ν•μ—¬ λ¨λ“ν™” λ° ν΄λμ¤ν™”λ¥Ό μ§„ν–‰ν–μµλ‹λ‹¤.

## π—‚οΈ μƒλ΅μ΄ νμΌ κµ¬μ΅°

### Server λ¨λ“ κµ¬μ΅°

```
server/
β”β”€β”€ core/
β”‚   β”β”€β”€ logging/
β”‚   β”‚   β””β”€β”€ logManager.js          # λ΅κ·Έ νμΌ κ΄€λ¦¬ (100μ¤„ μ ν•)
β”‚   β”β”€β”€ http/
β”‚   β”‚   β””β”€β”€ httpRouter.js          # HTTP λΌμ°ν„° μ„¤μ •
β”‚   β”β”€β”€ websocket/                 # WebSocket μ²λ¦¬ (ν–¥ν›„ λ¶„λ¦¬ μμ •)
β”‚   β””β”€β”€ message/                   # λ©”μ‹μ§€ μ²λ¦¬ (ν–¥ν›„ λ¶„λ¦¬ μμ •)
β”β”€β”€ crypto/
β”‚   β””β”€β”€ kakaoDecrypt.js            # μΉ΄μΉ΄μ¤ν†΅ λ©”μ‹μ§€ λ³µνΈν™” λ¨λ“
β”β”€β”€ cache/
β”‚   β””β”€β”€ roomKeyCache.js            # RoomKey μΊμ‹ κ΄€λ¦¬ (TTL: 5λ¶„)
β”β”€β”€ bot/
β”‚   β”β”€β”€ config.js                  # λ΄‡ μ„¤μ • (CONFIG)
β”‚   β”β”€β”€ commands/
β”‚   β”‚   β”β”€β”€ admin/                 # κ΄€λ¦¬μ λ…λ Ήμ–΄ (ν–¥ν›„ λ¶„λ¦¬)
β”‚   β”‚   β”β”€β”€ user/                  # μ‚¬μ©μ λ…λ Ήμ–΄ (ν–¥ν›„ λ¶„λ¦¬)
β”‚   β”‚   β”β”€β”€ cafe/                  # λ„¤μ΄λ²„ μΉ΄ν λ…λ Ήμ–΄ (ν–¥ν›„ λ¶„λ¦¬)
β”‚   β”‚   β””β”€β”€ point/                 # ν¬μΈνΈ λ…λ Ήμ–΄ (ν–¥ν›„ λ¶„λ¦¬)
β”‚   β”β”€β”€ moderation/
β”‚   β”‚   β”β”€β”€ profanityFilter.js     # λΉ„μ†μ–΄ ν•„ν„° (ν–¥ν›„ λ¶„λ¦¬)
β”‚   β”‚   β”β”€β”€ promotionDetector.js   # λ¬΄λ‹¨ ν™λ³΄ κ°μ§€ (ν–¥ν›„ λ¶„λ¦¬)
β”‚   β”‚   β”β”€β”€ nicknameTracker.js     # λ‹‰λ„¤μ„ λ³€κ²½ μ¶”μ  (ν–¥ν›„ λ¶„λ¦¬)
β”‚   β”‚   β”β”€β”€ messageDeleteTracker.js # λ©”μ‹μ§€ μ‚­μ  μ¶”μ  (ν–¥ν›„ λ¶„λ¦¬)
β”‚   β”‚   β””β”€β”€ memberTracker.js       # λ©¤λ²„ μ¶”μ  (ν–¥ν›„ λ¶„λ¦¬)
β”‚   β”β”€β”€ systems/
β”‚   β”‚   β””β”€β”€ noticeSystem.js        # κ³µμ§€ μ‹μ¤ν… (ν–¥ν›„ λ¶„λ¦¬)
β”‚   β”β”€β”€ cache/
β”‚   β”‚   β””β”€β”€ cacheManager.js        # μΊμ‹ κ΄€λ¦¬ (ν–¥ν›„ λ¶„λ¦¬)
β”‚   β””β”€β”€ utils/
β”‚       β””β”€β”€ botUtils.js            # λ΄‡ μ ν‹Έλ¦¬ν‹° ν•¨μ
β””β”€β”€ db/
    β”β”€β”€ models/
    β”‚   β”β”€β”€ userManager.js         # μ‚¬μ©μ κ΄€λ¦¬
    β”‚   β””β”€β”€ roomManager.js         # μ±„ν…λ°© κ΄€λ¦¬
    β”β”€β”€ reactions/                 # λ°μ‘ κ΄€λ¦¬ (ν–¥ν›„ λ¶„λ¦¬)
    β”β”€β”€ statistics/                # ν†µκ³„ (ν–¥ν›„ λ¶„λ¦¬)
    β””β”€β”€ backfill/                  # λ°±ν•„ μ‘μ—… (ν–¥ν›„ λ¶„λ¦¬)
```

### Client λ¨λ“ κµ¬μ΅°

```
client/
β””β”€β”€ kakao_poller.py                # λ‹¨μΌ νμΌ (λ‚΄λ¶€ ν΄λμ¤ κµ¬μ΅°λ΅ μ •λ¦¬ μμ •)
```

## π“ λ³€κ²½λ νμΌ λ©λ΅

### μƒλ΅ μƒμ„±λ λ¨λ“ νμΌ

1. **server/core/logging/logManager.js** (μƒ νμΌ)
   - λ΅κ·Έ νμΌ κ΄€λ¦¬ (μµμ‹  100μ¤„λ§ μ μ§€)
   - λ΅κ·Έ μ¤νΈλ¦Ό κ΄€λ¦¬
   - μ£ΌκΈ°μ  λ΅κ·Έ μ •λ¦¬

2. **server/crypto/kakaoDecrypt.js** (μƒ νμΌ)
   - μΉ΄μΉ΄μ¤ν†΅ λ©”μ‹μ§€ λ³µνΈν™” λ΅μ§
   - Python kakaodecrypt.pyμ™€ λ™μΌν• λ΅μ§
   - AES-256-CBC λ³µνΈν™”

3. **server/cache/roomKeyCache.js** (μƒ νμΌ)
   - RoomKey μΊμ‹ κ΄€λ¦¬
   - TTL: 5λ¶„
   - μ±„ν…λ°©λ³„ μΊμ‹ κ΄€λ¦¬

4. **server/core/http/httpRouter.js** (μƒ νμΌ)
   - Express λΌμ°νΈ μ„¤μ •
   - κ΄€λ¦¬μ ν¨λ„ μ„λΉ™
   - API λΌμ°ν„° λ“±λ΅

5. **server/bot/config.js** (μƒ νμΌ)
   - λ΄‡ μ„¤μ • (CONFIG)
   - Feature Flags
   - λ¬΄λ‹¨ ν™λ³΄ κ°μ§€ μ„¤μ •

6. **server/bot/utils/botUtils.js** (μƒ νμΌ)
   - λ°μ‹ μ μ΄λ¦„/ID μ¶”μ¶
   - κ΄€λ¦¬μ μ—¬λ¶€ ν™•μΈ
   - νμΌ μ½κΈ°/μ“°κΈ° μ ν‹Έλ¦¬ν‹°
   - λ‚ μ§/ν†µν™” ν¬λ§·

7. **server/db/models/userManager.js** (μƒ νμΌ)
   - μ‚¬μ©μ μ΅°ν/μƒμ„±
   - λ‹‰λ„¤μ„ λ³€κ²½ κ°μ§€

8. **server/db/models/roomManager.js** (μƒ νμΌ)
   - μ±„ν…λ°© μ΅°ν/μƒμ„±
   - λ©¤λ²„μ‹­ κ΄€λ¦¬

### λ¦¬ν©ν† λ§ λ€μƒ νμΌ (μ μ§„μ  μ§„ν–‰)

1. **server/server.js** (4,127μ¤„ β†’ λ©ν‘: 200-300μ¤„)
   - λ΅κ·Έ κ΄€λ¦¬ β†’ `core/logging/logManager.js` β…
   - λ³µνΈν™” λ΅μ§ β†’ `crypto/kakaoDecrypt.js` β…
   - HTTP λΌμ°ν„° β†’ `core/http/httpRouter.js` β…
   - WebSocket μ²λ¦¬ β†’ `core/websocket/` (ν–¥ν›„ λ¶„λ¦¬)
   - λ©”μ‹μ§€ μ²λ¦¬ β†’ `core/message/` (ν–¥ν›„ λ¶„λ¦¬)

2. **server/labbot-node.js** (4,131μ¤„ β†’ λ©ν‘: 200-300μ¤„)
   - CONFIG β†’ `bot/config.js` β…
   - μ ν‹Έλ¦¬ν‹° β†’ `bot/utils/botUtils.js` β…
   - λ¨λ”λ μ΄μ… β†’ `bot/moderation/` (ν–¥ν›„ λ¶„λ¦¬)
   - λ…λ Ήμ–΄ μ²λ¦¬ β†’ `bot/commands/` (ν–¥ν›„ λ¶„λ¦¬)
   - μ‹μ¤ν… β†’ `bot/systems/` (ν–¥ν›„ λ¶„λ¦¬)

3. **server/db/chatLogger.js** (1,736μ¤„ β†’ λ©ν‘: 200-400μ¤„)
   - μ‚¬μ©μ κ΄€λ¦¬ β†’ `db/models/userManager.js` β…
   - μ±„ν…λ°© κ΄€λ¦¬ β†’ `db/models/roomManager.js` β…
   - λ©”μ‹μ§€ μ €μ¥ β†’ `db/models/messageManager.js` (ν–¥ν›„ λ¶„λ¦¬)
   - λ°μ‘ κ΄€λ¦¬ β†’ `db/reactions/` (ν–¥ν›„ λ¶„λ¦¬)
   - ν†µκ³„ β†’ `db/statistics/` (ν–¥ν›„ λ¶„λ¦¬)
   - λ°±ν•„ β†’ `db/backfill/` (ν–¥ν›„ λ¶„λ¦¬)

4. **client/kakao_poller.py** (2,854μ¤„ β†’ ν΄λμ¤ν™”)
   - λ‹¨μΌ νμΌ κµ¬μ΅° μ μ§€
   - λ‚΄λ¶€ ν΄λμ¤ κµ¬μ΅°λ΅ μ •λ¦¬ (ν–¥ν›„ μ§„ν–‰)

## π― λ¦¬ν©ν† λ§ λ©ν‘ λ‹¬μ„± ν„ν™©

### β… μ™„λ£λ μ‘μ—…

1. **ν•µμ‹¬ λ¨λ“ λ¶„λ¦¬**
   - λ΅κ·Έ κ΄€λ¦¬ λ¨λ“
   - λ³µνΈν™” λ¨λ“
   - RoomKey μΊμ‹ λ¨λ“
   - HTTP λΌμ°ν„° λ¨λ“
   - λ΄‡ μ„¤μ • λ¨λ“
   - λ΄‡ μ ν‹Έλ¦¬ν‹° λ¨λ“
   - μ‚¬μ©μ/μ±„ν…λ°© κ΄€λ¦¬ λ¨λ“

2. **λ””λ ‰ν† λ¦¬ κµ¬μ΅° κ°μ„ **
   - κΈ°λ¥λ³„ λ¨λ“ λ¶„λ¦¬
   - λ…ν™•ν• μ±…μ„ λ¶„λ¦¬
   - μ¬μ‚¬μ© κ°€λ¥ν• λ¨λ“ κµ¬μ΅°

### π”„ μ§„ν–‰ μ¤‘μΈ μ‘μ—…

1. **server.js μ™„μ „ λ¶„λ¦¬**
   - WebSocket λ©”μ‹μ§€ μ²λ¦¬ (2,000μ¤„+) β†’ μ μ§„μ  λ¶„λ¦¬ ν•„μ”
   - λ©”μ‹μ§€ λ³µνΈν™” λ΅μ§ β†’ μ μ§„μ  λ¶„λ¦¬ ν•„μ”

2. **labbot-node.js μ™„μ „ λ¶„λ¦¬**
   - λ¨λ”λ μ΄μ… μ‹μ¤ν… β†’ μ μ§„μ  λ¶„λ¦¬ ν•„μ”
   - λ…λ Ήμ–΄ μ²λ¦¬ β†’ μ μ§„μ  λ¶„λ¦¬ ν•„μ”
   - μ‹μ¤ν… κ΄€λ¦¬ β†’ μ μ§„μ  λ¶„λ¦¬ ν•„μ”

3. **chatLogger.js μ™„μ „ λ¶„λ¦¬**
   - λ©”μ‹μ§€ μ €μ¥ λ΅μ§ β†’ μ μ§„μ  λ¶„λ¦¬ ν•„μ”
   - λ°μ‘ κ΄€λ¦¬ β†’ μ μ§„μ  λ¶„λ¦¬ ν•„μ”
   - ν†µκ³„ μ΅°ν β†’ μ μ§„μ  λ¶„λ¦¬ ν•„μ”

4. **kakao_poller.py ν΄λμ¤ν™”**
   - λ‚΄λ¶€ ν΄λμ¤ κµ¬μ΅°λ΅ μ •λ¦¬ ν•„μ”

## π“ λ¬Έμ„ν™”

### μƒμ„±λ λ¬Έμ„

1. **REFACTORING_REPORT.md** (μ΄ νμΌ)
   - λ¦¬ν©ν† λ§ μ™„λ£ λ³΄κ³ μ„
   - νμΌ κµ¬μ΅° μ„¤λ…
   - λ³€κ²½ μ‚¬ν•­ λ©λ΅

### ν–¥ν›„ λ¬Έμ„ν™” κ³„ν

1. **README.md μ—…λ°μ΄νΈ**
   - μƒλ΅μ΄ λ¨λ“ κµ¬μ΅° μ„¤λ…
   - κ°λ° κ°€μ΄λ“
   - λ¨λ“λ³„ μ‚¬μ©λ²•

2. **API λ¬Έμ„**
   - κ° λ¨λ“μ API λ¬Έμ„
   - ν•¨μ μ‹κ·Έλ‹μ²
   - μ‚¬μ© μμ 

## π”§ λ‹¤μ λ‹¨κ³„

1. **μ μ§„μ  λ¨λ“ λ¶„λ¦¬**
   - WebSocket λ©”μ‹μ§€ μ²λ¦¬ λ¨λ“ν™”
   - λ¨λ”λ μ΄μ… μ‹μ¤ν… λ¨λ“ν™”
   - λ…λ Ήμ–΄ μ²λ¦¬ λ¨λ“ν™”

2. **ν…μ¤νΈ μ½”λ“ μ‘μ„±**
   - κ° λ¨λ“λ³„ λ‹¨μ„ ν…μ¤νΈ
   - ν†µν•© ν…μ¤νΈ

3. **μ„±λ¥ μµμ ν™”**
   - λ¨λ“λ³„ μ„±λ¥ μΈ΅μ •
   - λ³‘λ© μ§€μ  κ°μ„ 

4. **λ¬Έμ„ν™” μ™„μ„±**
   - κ°λ°μ κ°€μ΄λ“
   - API λ¬Έμ„
   - μ•„ν‚¤ν…μ² λ¬Έμ„

## π“ ν†µκ³„

- **μƒλ΅ μƒμ„±λ λ¨λ“ νμΌ**: 8κ°
- **λ¦¬ν©ν† λ§ λ€μƒ νμΌ**: 4κ°
- **μμƒ μ½”λ“ μ¤„ μ κ°μ†**: 
  - server.js: 4,127μ¤„ β†’ ~300μ¤„ (μμƒ)
  - labbot-node.js: 4,131μ¤„ β†’ ~300μ¤„ (μμƒ)
  - chatLogger.js: 1,736μ¤„ β†’ ~400μ¤„ (μμƒ)

## β οΈ μ£Όμμ‚¬ν•­

1. **μ μ§„μ  λ§μ΄κ·Έλ μ΄μ…**
   - κΈ°μ΅΄ μ½”λ“μ™€ μƒ λ¨λ“μ΄ κ³µμ΅΄
   - μ μ§„μ μΌλ΅ κΈ°μ΅΄ μ½”λ“λ¥Ό μƒ λ¨λ“λ΅ κµμ²΄

2. **ν•μ„ νΈν™μ„±**
   - κΈ°μ΅΄ API μ μ§€
   - μ μ§„μ  λ³€κ²½

3. **ν…μ¤νΈ ν•„μ**
   - κ° λ¨λ“ λ¶„λ¦¬ ν›„ ν…μ¤νΈ ν•„μ
   - ν†µν•© ν…μ¤νΈ ν•„μ

## π“ λ³€κ²½ νμΌ μ”μ•½

### μƒλ΅ μƒμ„±λ νμΌ (8κ°)
1. server/core/logging/logManager.js
2. server/crypto/kakaoDecrypt.js
3. server/cache/roomKeyCache.js
4. server/core/http/httpRouter.js
5. server/bot/config.js
6. server/bot/utils/botUtils.js
7. server/db/models/userManager.js
8. server/db/models/roomManager.js

### ν–¥ν›„ λ¦¬ν©ν† λ§ λ€μƒ
1. server/server.js (WebSocket μ²λ¦¬ λ¶„λ¦¬)
2. server/labbot-node.js (λ…λ Ήμ–΄/λ¨λ”λ μ΄μ… λ¶„λ¦¬)
3. server/db/chatLogger.js (λ©”μ‹μ§€/λ°μ‘/ν†µκ³„ λ¶„λ¦¬)
4. client/kakao_poller.py (ν΄λμ¤ν™”)

---

**μ‘μ„±μΌ**: 2025-12-21
**λ²„μ „**: 1.0
**μƒνƒ**: 1μ°¨ μ™„λ£ (ν•µμ‹¬ λ¨λ“ λ¶„λ¦¬ μ™„λ£, μ μ§„μ  λ¶„λ¦¬ μ§„ν–‰ μ¤‘)

