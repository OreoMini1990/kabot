# 스케줄 공지 기능 수정 요약

## 문제점

1. **SQLite 사용**: `noticeSystem.js`가 SQLite (`db.prepare()`)를 사용하고 있음
2. **체크 간격 문제**: 30분마다 체크하여 정확한 시간(예: 09:00, 09:15)을 놓칠 수 있음
3. **트리거 부재**: 시간 감지와 DB 저장은 되지만 메시지 발송 트리거가 없음

## 수정 내용

### 1. Supabase 마이그레이션

**위치**: `server/bot/systems/noticeSystem.js`

**변경 내용**:
- SQLite `db.prepare()` → Supabase `db.supabase.from()`
- 모든 쿼리를 Supabase 형식으로 변경
- 에러 처리 및 로깅 개선

**주요 변경 사항**:
- `shouldSendScheduledNotice`: Supabase 쿼리로 변경
- `getNotice`: Supabase 쿼리로 변경
- 상세한 로그 출력 추가 (디버깅용)

### 2. 체크 간격 개선

**위치**: `server/server.js` (라인 3599-3604)

**변경 전**: 30분마다 체크 (1800000ms)
**변경 후**: 1분마다 체크 (60000ms)

**이유**: 정확한 시간(예: 09:00, 09:15, 09:30)에 발송하기 위해 1분 간격으로 체크

### 3. 로그 개선

**추가된 로그**:
- 현재 시간 및 공지 개수
- 각 공지의 스케줄 시간 매칭 여부
- 발송 기록 확인 결과
- 발송 성공/실패 상세 정보

## 예상 결과

1. **정확한 시간 발송**: 1분 간격 체크로 정확한 시간에 발송
2. **Supabase 연동**: DB 저장 및 조회가 정상 작동
3. **디버깅 용이**: 상세한 로그로 문제 추적 가능

## 테스트 필요 사항

1. **스케줄 공지 설정**: 관리자 페이지에서 스케줄 공지 설정
2. **시간 매칭 확인**: 설정한 시간에 발송되는지 확인
3. **로그 확인**: `[스케줄 공지]` 관련 로그 확인
4. **중복 발송 방지**: 같은 시간에 여러 번 발송되지 않는지 확인

## 변경 파일

### [수정] server/bot/systems/noticeSystem.js
- SQLite → Supabase 마이그레이션
- 로그 개선

### [수정] server/server.js
- 체크 간격: 30분 → 1분

## 추가 개선 사항 (선택)

### Draft 시스템 도입 (선택사항)
질문 시스템처럼 draft로 관리할 수 있도록 개선 가능:
- `notice_drafts` 테이블 추가
- 관리자 페이지에서 draft 작성 및 발행
- 발행 전 미리보기 기능

현재는 Supabase 마이그레이션과 체크 간격 개선으로 해결 가능합니다.

