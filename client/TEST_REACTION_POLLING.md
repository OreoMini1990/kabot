# ν΄λΌμ΄μ–ΈνΈ λ°μ‘ λ°μ΄ν„° μ΅°ν ν…μ¤νΈ κ°€μ΄λ“

## λ©μ 

`client/kakao_poller.py`μ `poll_reaction_updates()` ν•¨μκ°€ μΉ΄μΉ΄μ¤ν†΅ DBμ—μ„ `v` ν•„λ“μ™€ `supplement` ν•„λ“μ λ°μ‘ λ°μ΄ν„°λ¥Ό μ λ€λ΅ κ°€μ Έμ¤λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

## ν…μ¤νΈ μ¤ν¬λ¦½νΈ

`client/test_reaction_polling.py` - ν΄λΌμ΄μ–ΈνΈ μ½”λ“μ™€ λ™μΌν• λ΅μ§μΌλ΅ DBλ¥Ό μ΅°νν•μ—¬ λ°μ‘ λ°μ΄ν„°λ¥Ό ν™•μΈ

## ν…μ¤νΈ λ°©λ²•

### λ°©λ²• 1: Termuxμ—μ„ μ§μ ‘ μ‹¤ν–‰ (κ¶μ¥)

Android κΈ°κΈ°μ Termuxμ—μ„ μ§μ ‘ μ‹¤ν–‰ν•λ” λ°©λ²•μ…λ‹λ‹¤. ADB μ—°κ²°μ΄ ν•„μ” μ—†μµλ‹λ‹¤.

```bash
# Termuxμ—μ„ μ‹¤ν–‰
cd ~/kakkaobot  # λλ” ν”„λ΅μ νΈ κ²½λ΅
python client/test_reaction_polling.py

# λλ” DB κ²½λ΅ μ§μ ‘ μ§€μ •
python client/test_reaction_polling.py /data/data/com.kakao.talk/databases/KakaoTalk.db
```

**μ£Όμ**: Termuxμ—μ„ μ‹¤ν–‰ν•λ ¤λ©΄:
- Termuxκ°€ root κ¶ν•μΌλ΅ μ‹¤ν–‰λκ±°λ‚
- λλ” `kakao_poller.py`κ°€ μ‚¬μ©ν•λ” κ²ƒκ³Ό λ™μΌν• DB κ²½λ΅μ— μ ‘κ·Όν•  μ μμ–΄μ•Ό ν•©λ‹λ‹¤.

### λ°©λ²• 2: λ΅μ»¬μ—μ„ μ‹¤ν–‰ (DB νμΌ λ³µμ‚¬ ν›„)

Windowsλ‚ Linuxμ—μ„ μ‹¤ν–‰ν•λ” λ°©λ²•μ…λ‹λ‹¤.

#### 2.1 DB νμΌ μ¶”μ¶ (Android κΈ°κΈ°μ—μ„)

**μµμ… A: ADB μ‚¬μ© (κΈ°κΈ° μ—°κ²° μ‹)**

```powershell
# PowerShell (Windows)
adb shell "su -c 'cp /data/data/com.kakao.talk/databases/KakaoTalk.db /sdcard/KakaoTalk.db'"
adb pull /sdcard/KakaoTalk.db ./KakaoTalk.db
```

```bash
# Linux/Mac
adb shell "su -c 'cp /data/data/com.kakao.talk/databases/KakaoTalk.db /sdcard/KakaoTalk.db'"
adb pull /sdcard/KakaoTalk.db ./KakaoTalk.db
```

**μµμ… B: Termuxμ—μ„ μ§μ ‘ λ³µμ‚¬**

```bash
# Termuxμ—μ„ μ‹¤ν–‰ (root κ¶ν• ν•„μ”)
cp /data/data/com.kakao.talk/databases/KakaoTalk.db ~/KakaoTalk.db

# λλ” SCPλ΅ PCλ΅ μ „μ†΅
scp ~/KakaoTalk.db user@your-pc-ip:/path/to/destination/
```

#### 2.2 λ΅μ»¬μ—μ„ ν…μ¤νΈ μ‹¤ν–‰

```powershell
# PowerShell (Windows)
python client/test_reaction_polling.py .\KakaoTalk.db

# λλ” ν™κ²½λ³€μ μ„¤μ •
$env:KAKAO_DB_PATH = ".\KakaoTalk.db"
python client/test_reaction_polling.py
```

```bash
# Linux/Mac
python3 client/test_reaction_polling.py ./KakaoTalk.db

# λλ” ν™κ²½λ³€μ μ„¤μ •
export KAKAO_DB_PATH=./KakaoTalk.db
python3 client/test_reaction_polling.py
```

### λ°©λ²• 3: μ‹¤μ  ν΄λΌμ΄μ–ΈνΈ μ½”λ“λ΅ ν…μ¤νΈ

`kakao_poller.py`λ¥Ό μ‹¤ν–‰ν•λ©΄ μλ™μΌλ΅ λ°μ‘ μ—…λ°μ΄νΈλ¥Ό ν™•μΈν•©λ‹λ‹¤:

```bash
# Termuxμ—μ„
cd ~/kakkaobot
python client/kakao_poller.py
```

λ΅κ·Έμ—μ„ λ‹¤μκ³Ό κ°™μ€ λ©”μ‹μ§€λ¥Ό ν™•μΈν•μ„Έμ”:
- `[λ°μ‘ μ—…λ°μ΄νΈ ν™•μΈ] μ‹μ‘: μµκ·Ό λ©”μ‹μ§€ Nκ° ν™•μΈ`
- `[λ°μ‘ ν™•μΈ] msg_id=XXX, defaultEmoticonsCount=N`
- `[λ°μ‘ μ—…λ°μ΄νΈ κ°μ§€] β…`

## ν…μ¤νΈ λ‚΄μ©

μ¤ν¬λ¦½νΈλ” λ‹¤μμ„ ν™•μΈν•©λ‹λ‹¤:

1. β… DB μ—°κ²° λ° ν…μ΄λΈ” κµ¬μ΅° ν™•μΈ
2. β… `v` μ»¬λΌκ³Ό `supplement` μ»¬λΌ μ΅΄μ¬ μ—¬λ¶€
3. β… ν΄λΌμ΄μ–ΈνΈ μ½”λ“μ™€ λ™μΌν• μΏΌλ¦¬ μ‹¤ν–‰ (μµκ·Ό 24μ‹κ°„ λ‚΄ λ©”μ‹μ§€ 100κ°)
4. β… `v` ν•„λ“μ—μ„ `defaultEmoticonsCount` νμ‹±
5. β… `supplement` ν•„λ“μ—μ„ `reactions` λλ” `emoticons` νμ‹±
6. β… νμ‹± μ¤λ¥ κ°μ§€ λ° λ³΄κ³ 

## μμƒ μ¶λ ¥

### μ„±κ³µ μ‹

```
============================================================
ν΄λΌμ΄μ–ΈνΈ λ°μ‘ λ°μ΄ν„° μ΅°ν ν…μ¤νΈ
============================================================
DB κ²½λ΅: /data/data/com.kakao.talk/databases/KakaoTalk.db

β… DB μ—°κ²° μ„±κ³µ

π“‹ chat_logs ν…μ΄λΈ” μ»¬λΌ:
  _id, chat_id, user_id, message, v, supplement, type, created_at

  v μ»¬λΌ μ΅΄μ¬: β… μ
  supplement μ»¬λΌ μ΅΄μ¬: β… μ

============================================================
ν΄λΌμ΄μ–ΈνΈ poll_reaction_updates() ν•¨μμ™€ λ™μΌν• μΏΌλ¦¬ μ‹¤ν–‰
============================================================

β… μµκ·Ό 24μ‹κ°„ λ‚΄ λ©”μ‹μ§€: 50κ° μ΅°νλ¨

[DB κ²€μ¦] μ²« λ©”μ‹μ§€: msg_id=12345, μ»¬λΌ μ=6
[DB κ²€μ¦] v ν•„λ“ μ΅΄μ¬=True, supplement μ΅΄μ¬=True
[DB κ²€μ¦] v ν•„λ“ μƒν”: {"enc":31,"origin":"","isMine":false,"defaultEmoticonsCount":2}...

============================================================
v ν•„λ“ νμ‹± ν…μ¤νΈ (ν΄λΌμ΄μ–ΈνΈ λ΅μ§κ³Ό λ™μΌ)
============================================================

[1] β… msg_id=12345, defaultEmoticonsCount=2
     v ν•„λ“ keys: ['enc', 'origin', 'isMine', 'defaultEmoticonsCount', ...]

============================================================
κ²°κ³Ό μ”μ•½
============================================================
μ΄ μ΅°ν λ©”μ‹μ§€: 50κ°
λ°μ‘μ΄ μλ” λ©”μ‹μ§€: 3κ°
νμ‹± μ¤λ¥: 0κ°

β… λ°μ‘μ΄ μλ” λ©”μ‹μ§€ μƒμ„Έ:
  - msg_id=12345, λ°μ‘ κ°μ=2
    supplement reactions: 2κ°

============================================================
supplement ν•„λ“ νμ‹± ν…μ¤νΈ
============================================================

supplementμ— λ°μ‘ μ •λ³΄κ°€ μλ” λ©”μ‹μ§€: 2κ°

β… supplement λ°μ‘ μ •λ³΄ μƒμ„Έ (μ²μ 3κ°):
  - msg_id=12345, reactions κ°μ=2
    [1] type=thumbs_up, user_id=1234567890
    [2] type=heart, user_id=9876543210

============================================================
ν…μ¤νΈ μ™„λ£
============================================================
β… ν΄λΌμ΄μ–ΈνΈκ°€ λ°μ‘ λ°μ΄ν„°λ¥Ό μ λ€λ΅ κ°€μ Έμ¬ μ μμµλ‹λ‹¤.
```

### μ‹¤ν¨ μ‹ (λ°μ‘ λ°μ΄ν„° μ—†μ)

```
============================================================
κ²°κ³Ό μ”μ•½
============================================================
μ΄ μ΅°ν λ©”μ‹μ§€: 50κ°
λ°μ‘μ΄ μλ” λ©”μ‹μ§€: 0κ°
νμ‹± μ¤λ¥: 0κ°

β οΈ λ°μ‘ λ°μ΄ν„°κ°€ μλ” λ©”μ‹μ§€κ°€ μ—†μµλ‹λ‹¤. (μµκ·Ό 24μ‹κ°„ λ‚΄)
   μ‹¤μ λ΅ λ°μ‘μ΄ μλ” λ©”μ‹μ§€κ°€ μλ”μ§€ ν™•μΈν•μ„Έμ”.
```

## λ¬Έμ  ν•΄κ²°

### μ¤λ¥: "DB νμΌμ„ μ°Ύμ„ μ μ—†μµλ‹λ‹¤"

**ν•΄κ²° λ°©λ²•**:
1. DB κ²½λ΅κ°€ μ¬λ°”λ¥Έμ§€ ν™•μΈ
2. νμΌμ΄ μ‹¤μ λ΅ μ΅΄μ¬ν•λ”μ§€ ν™•μΈ
3. μ½κΈ° κ¶ν•μ΄ μλ”μ§€ ν™•μΈ

### μ¤λ¥: "v λλ” supplement μ»¬λΌμ΄ μ—†μ–΄ λ°μ‘ μ •λ³΄λ¥Ό κ°€μ Έμ¬ μ μ—†μµλ‹λ‹¤"

**μ›μΈ**: μΉ΄μΉ΄μ¤ν†΅ λ²„μ „μ΄ μ¤λλμ—κ±°λ‚ DB κµ¬μ΅°κ°€ λ‹¤λ¥Ό μ μμµλ‹λ‹¤.

**ν•΄κ²° λ°©λ²•**: μΉ΄μΉ΄μ¤ν†΅μ„ μµμ‹  λ²„μ „μΌλ΅ μ—…λ°μ΄νΈ

### μ¤λ¥: "λ°μ‘ λ°μ΄ν„°κ°€ μλ” λ©”μ‹μ§€κ°€ μ—†μµλ‹λ‹¤"

**μ›μΈ**: μµκ·Ό 24μ‹κ°„ λ‚΄μ— λ°μ‘μ΄ μλ” λ©”μ‹μ§€κ°€ μ—†μ„ μ μμµλ‹λ‹¤.

**ν•΄κ²° λ°©λ²•**:
1. μ‹¤μ λ΅ μΉ΄μΉ΄μ¤ν†΅μ—μ„ λ©”μ‹μ§€μ— λ°μ‘μ„ λλ¬λ³΄μ„Έμ”
2. ν…μ¤νΈ μ¤ν¬λ¦½νΈμ `twenty_four_hours_ago` μ‹κ°„ λ²”μ„λ¥Ό λλ ¤λ³΄μ„Έμ”

### ADB μ—°κ²° μ¤λ¥ (λ°©λ²• 2 μ‚¬μ© μ‹)

**μ¦μƒ**: `adb: no devices/emulators found`

**ν•΄κ²° λ°©λ²•**:
1. USB λ””λ²„κΉ…μ΄ ν™μ„±ν™”λμ–΄ μλ”μ§€ ν™•μΈ
2. κΈ°κΈ°κ°€ USBλ΅ μ—°κ²°λμ–΄ μλ”μ§€ ν™•μΈ
3. `adb devices`λ΅ κΈ°κΈ° μΈμ‹ μ—¬λ¶€ ν™•μΈ
4. λ°©λ²• 1(Termux μ§μ ‘ μ‹¤ν–‰)μ„ μ‚¬μ©ν•λ” κ²ƒμ„ κ¶μ¥ν•©λ‹λ‹¤

## μ¶”κ°€ μ •λ³΄

- ν΄λΌμ΄μ–ΈνΈ μ½”λ“: `client/kakao_poller.py`μ `poll_reaction_updates()` ν•¨μ
- DB κµ¬μ΅°: `chat_logs` ν…μ΄λΈ”μ `v` (JSON) λ° `supplement` (JSON) μ»¬λΌ
- λ°μ‘ λ°μ΄ν„° ν•μ‹: `v.defaultEmoticonsCount` (λ°μ‘ κ°μ), `supplement.reactions` (λ°μ‘ μƒμ„Έ μ •λ³΄)










